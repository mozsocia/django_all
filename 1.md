To implement the desired functionality using Django REST Framework (DRF) and APIView, you can define the following views and URLs:
```py
class Product(models.Model):
    name = models.CharField(max_length=100)
    quantity = models.PositiveIntegerField()

    def __str__(self):
        return self.name

class Purchase(models.Model):
    name = models.CharField(max_length=100)
    total_price = models.DecimalField(max_digits=10, decimal_places=2)
    timestamp = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.name

class PurchasedProduct(models.Model):
    purchase = models.ForeignKey(Purchase, on_delete=models.CASCADE)
    product = models.ForeignKey(Product, on_delete=models.CASCADE)
    quantity = models.PositiveIntegerField()

    def __str__(self):
        return f'{self.purchase.name} - {self.product.name}'
```



Make sure you have serializers defined for the models:

```python
# serializers.py
from rest_framework import serializers
from .models import Product, Purchase, PurchasedProduct

class ProductSerializer(serializers.ModelSerializer):
    class Meta:
        model = Product
        fields = '__all__'

class PurchaseSerializer(serializers.ModelSerializer):
    class Meta:
        model = Purchase
        fields = '__all__'

class PurchasedProductSerializer(serializers.ModelSerializer):
    class Meta:
        model = PurchasedProduct
        fields = '__all__'
        extra_kwargs = {
            'purchase': {'required': False, "allow_null": True}
        }
```

1. Product List and Create:

```python
# views.py
from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import status
from .models import Product
from .serializers import ProductSerializer

class ProductListCreateAPIView(APIView):
    def get(self, request):
        products = Product.objects.all()
        serializer = ProductSerializer(products, many=True)
        return Response(serializer.data)

    def post(self, request):
        serializer = ProductSerializer(data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
```

```python
# urls.py
from django.urls import path
from .views import ProductListCreateAPIView

urlpatterns = [
    path('products/', ProductListCreateAPIView.as_view(), name='product-list-create'),
]
```

2. Purchase List and Create:

```python
# views.py
from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import status
from .models import Purchase, PurchasedProduct
from .serializers import PurchaseSerializer, PurchasedProductSerializer

class PurchaseListCreateAPIView(APIView):
    def get(self, request):
        purchases = Purchase.objects.all()
        serializer = PurchaseSerializer(purchases, many=True)
        return Response(serializer.data)

    def post(self, request):
        purchase_serializer = PurchaseSerializer(data=request.data)
        
        
        purchased_products_serializer = PurchasedProductSerializer(
            data=request.data.get('purchased_products'), many=True)
        
        if purchase_serializer.is_valid() and purchased_products_serializer.is_valid():
            # purchase = purchase_serializer.save()
            with transaction.atomic():
                purchase_data = purchase_serializer.validated_data
                purchase = Purchase.objects.create(
                    name=purchase_data['name'],
                    total_price=purchase_data['total_price']
                )
                
                for purchased_product_data in purchased_products_serializer.data:
                    product_id = purchased_product_data['product']
                    quantity = purchased_product_data['quantity']
                    
                    product = Product.objects.get(pk=product_id)
                    product.quantity += quantity
                    product.save()
                    
                    PurchasedProduct.objects.create(
                        purchase=purchase,
                        product=product,
                        quantity=quantity
                    )
                
            return Response(purchase_serializer.data, status=status.HTTP_201_CREATED)
        
        errors = {}
        if not purchase_serializer.is_valid():
            errors['purchase'] = purchase_serializer.errors
        if not purchased_products_serializer.is_valid():
            errors['purchased_products'] = purchased_products_serializer.errors
        
        return Response(errors, status=status.HTTP_400_BAD_REQUEST)
```

```python
# urls.py
from django.urls import path
from .views import PurchaseListCreateAPIView

urlpatterns = [
    path('purchases/', PurchaseListCreateAPIView.as_view(), name='purchase-list-create'),
]
```

Remember to include the URLs in your main `urls.py` file.



Sure! Here's an example of JSON data you can use to create 5 products and 2 purchases using the API endpoints:

For creating 5 products:
```json
{
  "products": [
    {
      "name": "Product 1",
      "quantity": 10
    },
    {
      "name": "Product 2",
      "quantity": 20
    },
    {
      "name": "Product 3",
      "quantity": 15
    },
    {
      "name": "Product 4",
      "quantity": 5
    },
    {
      "name": "Product 5",
      "quantity": 8
    }
  ]
}
```

For creating 2 purchases, along with the purchased products:
```json
{
  "name": "Purchase 1",
  "total_price": 100.00,
  "purchased_products": [
    {
      "product": 1,
      "quantity": 2
    },
    {
      "product": 3,
      "quantity": 4
    }
  ]
}
```

```json
{
  "name": "Purchase 2",
  "total_price": 50.00,
  "purchased_products": [
    {
      "product": 2,
      "quantity": 3
    },
    {
      "product": 4,
      "quantity": 1
    }
  ]
}
```

Please note that in the JSON data for creating purchases, the "product" field corresponds to the ID of the product you want to purchase. Make sure to replace the IDs (e.g., 1, 2, 3, etc.) with the actual IDs of the products you created or plan to create.
